<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Hello Distri!</title>
  <meta name="description" content="">

  
  
  <link rel="stylesheet" href="/assets/style.css">
  <link rel="stylesheet" href="/assets/perldoc.css">
  <link rel="canonical" href="http://0.0.0.0:8080/tutorials/hello/">
  <link rel="alternate" type="application/rss+xml" title="" href="http://0.0.0.0:8080/feed.xml">

  <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>


  <body>

    <div>
      
      <header class="header-background">
      <header class="border-bottom-thick px-2 clearfix">
  <div class="left sm-width-full py-1 mt-1 mt-lg-0">
    <a class="align-middle link-primary text-accent" href="/">
      
    </a>
  </div>
  <div class="right sm-width-full">
    <ul class="list-reset mt-lg-1 mb-2 mb-lg-1">
      
        
        <li class="inline-block">
          <a class="align-middle link-primary mr-2 mr-lg-0 ml-lg-2" href="/doc/">
            API
          </a>
        </li>
        
      
        
        <li class="inline-block">
          <a class="align-middle link-primary mr-2 mr-lg-0 ml-lg-2" href="/faq/">
            FAQ
          </a>
        </li>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
        <li class="inline-block">
          <a class="align-middle link-primary mr-2 mr-lg-0 ml-lg-2" href="/tutorials/">
            Tutorials
          </a>
        </li>
        
      
        
      
    </ul>
  </div>
</header>


        <div class="container mx-auto px-2 mb-2 clearfix header-text">
          <h2 class="h0 inline-block col-9 sm-width-full mt-3 header-title">Hello Distri!</h2>

          <div class="clearfix mb-4 py-1">
            <div class="col-4 sm-width-full left border-top-thin">

              <!-- Set site description in config.yml -->
              <p class="h4 lh-condensed font-smoothing mt-2 py-1">Make a simple "Hello World" server in Distri</p>
            </div>

          </div>

        </div>
      </header>

      <div class="container mx-auto px-2 py-4">
        <p>Distri was made to be very minimalistic, providing you pretty much nothing but a tiny framework to help distribute work, and return it to the server. Other than the verification strength feature (which we will go over more in depth in the Collatz tutorial), Distri leaves all verification up to you. So, without further ado, let’s make a simple example server.</p>

<p>Distri is split into two parts, <em>Distri.js</em>, and <em>Distri-Node</em>. These are two different things, be sure to keep that in mind. <em>Distri.js</em> is on the client side, and runs the work that it’s provided from <em>Distri-Node</em>. We will start with Distri-Node and get a simple do-nothing server running first.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="cm">/* server.js */</span>
<span class="kr">const</span> <span class="nx">Distri</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'distri-node'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Distri</span><span class="p">.</span><span class="nx">DistriServer</span><span class="p">({})</span>
</code></pre>
</div>

<p>We now have a simple running server, that does nothing at all. (Yes, the second that constructor is called, it’s running. Remember that!) However, our server doesn’t quite do anything yet, so we need to change that! We’re still missing a worker file, any kind of data handling, and any work. When a user connects, they will be told there is no work, and to go away. That’s rude, we don’t want our kind clients leaving, so let’s keep Distri from telling them that!</p>

<p>Right now the only thing we want is to have the client recieve “Hello”, and return “ Distri!”. The client will recieve “Hello” through <em>work</em>, which is what Distri gives to all connected clients. So, let’s add “Hello” to the work queue!</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="cm">/* server.js */</span>
<span class="kr">const</span> <span class="nx">Distri</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'distri-node'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Distri</span><span class="p">.</span><span class="nx">DistriServer</span><span class="p">({})</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">addWork</span><span class="p">([</span><span class="s1">'Hello'</span><span class="p">])</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">addWork</code> method of the Distri server takes an array to be appended to the work queue. The content of the array must be able to be stringified into JSON, or Distri will crash.</p>

<p>Now that we have work, we are still missing any kind of data handling, and a worker file. Let’s build the worker file right now!</p>

<p>The worker files in Distri are nothing more than Web Worker files, so if you’re used to working with those, you should be very familiar with the syntax. If you haven’t worked with Web Workers before, <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers"><span style="color: blue">here is a good place to start</span></a>.</p>

<p>Let’s start making our worker file.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="cm">/* worker.js */</span>
<span class="nx">onmessage</span> <span class="o">=</span> <span class="nx">m</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">postMessage</span><span class="p">({</span><span class="na">result</span><span class="p">:</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">work</span><span class="p">})</span>
<span class="p">}</span>
</code></pre>
</div>

<p>When this worker script receives a message, it will simply echo it back to the server. The work is stored in <code class="highlighter-rouge">m.data.work</code>, so remember that. Also, the work must be submitted in the form of an object, with the <code class="highlighter-rouge">result</code> property holding the result. This is due to how the <code class="highlighter-rouge">postMessage</code> function works.</p>

<p>We don’t want the script to echo back the message exactly, however. We want it to return “ Distri!”. Obviously, it won’t be too hard.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="cm">/* worker.js */</span>
<span class="nx">onmessage</span> <span class="o">=</span> <span class="nx">m</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">postMessage</span><span class="p">({</span><span class="na">result</span><span class="p">:</span><span class="s2">" Distri!"</span><span class="p">})</span>
<span class="p">}</span>
</code></pre>
</div>

<p>That’s it! Your worker file is done, but your server has no way to give it to your client (yet). We still have a little work to do to have our server fully functioning. As of now, we haven’t given the WebSocket constructor any options, so it justs runs with the defaults, which is probably not what you want. If you’ve worked with the <span style="color: blue"><a href="https://github.com/websockets/ws"><code class="highlighter-rouge">ws</code></a></span> module before, this will be familiar to you. If not, there’s not too much to memorize, as we will only be messing with one option.</p>

<p>Options to the <code class="highlighter-rouge">ws</code> constructor are passed from the <code class="highlighter-rouge">connection</code> property in the object passed to the DistriServer constructor. For this example, we only want to specify the port we’re running on, so let’s do that now.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="cm">/* server.js */</span>
<span class="kr">const</span> <span class="nx">Distri</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'distri-node'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Distri</span><span class="p">.</span><span class="nx">DistriServer</span><span class="p">({</span>
    <span class="na">connection</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">port</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">8080</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">addWork</span><span class="p">([</span><span class="s1">'Hello'</span><span class="p">])</span>
</code></pre>
</div>

<p>We only have two things left to do so make sure to hold out! We still have no way to get the file to our user, and no way to get the result passed back. Let’s fix that first part right now. The DistriServer constructor takes another object property, <code class="highlighter-rouge">files</code>, which is, surprise, another object. This object has two properties, <code class="highlighter-rouge">javascript</code> and <code class="highlighter-rouge">node</code>, both contain strings. Let’s create it right now.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="cm">/* server.js */</span>
<span class="kr">const</span> <span class="nx">Distri</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'distri-node'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Distri</span><span class="p">.</span><span class="nx">DistriServer</span><span class="p">({</span>
    <span class="na">connection</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">port</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">8080</span>
    <span class="p">},</span>
    <span class="na">files</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">javascript</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span>
        <span class="na">node</span><span class="p">:</span> <span class="s1">''</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">addWork</span><span class="p">([</span><span class="s1">'Hello'</span><span class="p">])</span>
</code></pre>
</div>

<p>Now, upload your worker file to a place where you can get a URL that returns the raw content of the file when you fetch the link. (You don’t even have to use rawgit or a similar service. As long as the content is in plain text, file type headers will not matter.)</p>

<p>Now, add that link to the <code class="highlighter-rouge">javascript</code> property in <code class="highlighter-rouge">files</code>.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="cm">/* server.js */</span>
<span class="kr">const</span> <span class="nx">Distri</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'distri-node'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Distri</span><span class="p">.</span><span class="nx">DistriServer</span><span class="p">({</span>
    <span class="na">connection</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">port</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">8080</span>
    <span class="p">},</span>
    <span class="na">files</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">javascript</span><span class="p">:</span> <span class="s1">'https://gist.githubusercontent.com/Flarp/9ff6cc8089099c99993102777b392121/raw/ecea94ed92ae80d65c6fd9afe1ba09d7d83dedc1/example-hello-distri.js'</span><span class="p">,</span>
        <span class="na">node</span><span class="p">:</span> <span class="s1">''</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">addWork</span><span class="p">([</span><span class="s1">'Hello'</span><span class="p">])</span>
</code></pre>
</div>

<p>When a user submits work, it goes through a process within Distri (which we won’t deal with until next tutorial), and is then sent to the server through the event <code class="highlighter-rouge">workgroup_complete</code>. It is emitted from the server object like a normal event emitter, so let’s listen for the event!</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="cm">/* server.js */</span>
<span class="kr">const</span> <span class="nx">Distri</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'distri-node'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Distri</span><span class="p">.</span><span class="nx">DistriServer</span><span class="p">({</span>
    <span class="na">connection</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">port</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">8080</span>
    <span class="p">},</span>
    <span class="na">files</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">javascript</span><span class="p">:</span> <span class="s1">'https://gist.githubusercontent.com/Flarp/9ff6cc8089099c99993102777b392121/raw/ecea94ed92ae80d65c6fd9afe1ba09d7d83dedc1/example-hello-distri.js'</span><span class="p">,</span>
        <span class="na">node</span><span class="p">:</span> <span class="s1">''</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">addWork</span><span class="p">([</span><span class="s1">'Hello'</span><span class="p">])</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'workgroup_complete'</span><span class="p">,</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">rej</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">(</span><span class="nx">o</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="p">})</span>
</code></pre>
</div>

<p>The bottom three lines probably are very new and obscure, but that’s an easy fix. Let’s go through it bit by bit.</p>

<p><code class="highlighter-rouge">server.on('workgroup_complete', (i, o, res, rej) =&gt; {...}</code></p>

<p>The DistriServer object extends <code class="highlighter-rouge">EventEmitter</code>, so it can emit events. When the event <code class="highlighter-rouge">workgroup_complete</code> is emitted, it provides a callback with four parameters, <code class="highlighter-rouge">i</code>, <code class="highlighter-rouge">o</code>, <code class="highlighter-rouge">res</code>, <code class="highlighter-rouge">rej</code>.</p>

<ul>
  <li><code class="highlighter-rouge">i</code> - The work that was given to the user. (In this case, <code class="highlighter-rouge">'Hello'</code>)</li>
  <li><code class="highlighter-rouge">o</code> - The array of sent back work. (This is an array, for reasons that we will discuss in the next tutorial. For our purposes it only has one item, so we can just use the first element in the array.)</li>
  <li><code class="highlighter-rouge">res</code> - A function from a Promise that accepts the work. Takes one parameter, the work to be accepted.</li>
  <li><code class="highlighter-rouge">rej</code> - A function from a Promise that rejects the work.</li>
</ul>

<p>The second line accepts (or “resolves”) the first item in the array, which is “ Distri!”. Once the file is accepted, it is passed onto the next event, <code class="highlighter-rouge">workgroup_accepted</code>. Let’s listen for that.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="cm">/* server.js */</span>
<span class="kr">const</span> <span class="nx">Distri</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'distri-node'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Distri</span><span class="p">.</span><span class="nx">DistriServer</span><span class="p">({</span>
    <span class="na">connection</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">port</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">8080</span>
    <span class="p">},</span>
    <span class="na">files</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">javascript</span><span class="p">:</span> <span class="s1">'https://gist.githubusercontent.com/Flarp/9ff6cc8089099c99993102777b392121/raw/ecea94ed92ae80d65c6fd9afe1ba09d7d83dedc1/example-hello-distri.js'</span><span class="p">,</span>
        <span class="na">node</span><span class="p">:</span> <span class="s1">''</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">addWork</span><span class="p">([</span><span class="s1">'Hello'</span><span class="p">])</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'workgroup_complete'</span><span class="p">,</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">rej</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">(</span><span class="nx">o</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="p">})</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'workgroup_accepted'</span><span class="p">,</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span>
<span class="p">})</span>
</code></pre>
</div>

<p>The last three lines accept the work resolved from <code class="highlighter-rouge">workgroup_complete</code>, and log them to the console, joined together.</p>

<p>Our server side is done, but our client side is not. We still need a running website with Distri on it, so let’s make a skeleton right now.</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="c">&lt;!-- index.html --&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="c">&lt;!--whatever you want here--&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="c">&lt;!-- Distri must be loaded below the body --&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"path/to/distri.js.min"</span><span class="nt">&gt;&lt;/script&gt;</span>

</code></pre>
</div>

<p>Right now you may now have a <code class="highlighter-rouge">distri.js.min</code>, but getting one is very simple. There is a tutorial on it <a href="/tutorial/webpack"><span style="color: blue;">here</span></a>.</p>

<p>Now, host your HTML file and visit the website. The first time you visit it, it should ask you if you are okay with Distri being run on your computer. You might be tempted to click okay, but for our purposes, we need to hit “Options”. Another menu will popup, and you’ll see your server <em>isn’t there</em>.</p>

<p>“<em>What?! Why?!</em>”</p>

<p>Distri gets all of its informations from databases (glorified JSON files) that host the metadata for Distri servers, like its name, description, and lots of other important stuff so your client can actually connect to it. Right now you are using a default database, which really doesn’t have too much in it. To be able to connect to your server, you need to manually add it. At the bottom of the menu, there is a yellow button that reads “Add Server”.</p>

<center><img src="http://img.pixady.com/2017/03/458418_capture.png" /></center>

<p>When you click that, another item will be added to the list, and it will have a textbox in it. This is where you can input the URL for your server. If you are running it locally, it should be <code class="highlighter-rouge">localhost:8080</code>. Make sure you run your Distri server, and hit “Enter” to confirm the link, and click “Finish”. Now, check your console.</p>

<center><img src="http://img.pixady.com/2017/03/574497_hello.png" /></center>

<p>You’ve done it! You’ve made your first Distri server! This was obviously a very simple one, and didn’t utilize too many Distri features, but the next few tutorials will let you get familiar with these features, so you can become a Distri master!</p>


      </div>

    </div>

    <div class="border-top-thin clearfix mt-2 mt-lg-4">
  <div class="container mx-auto px-2">
    <p class="col-8 sm-width-full left py-2 mb-0">This project is maintained by <a class="text-accent" href="https://github.com/"></a></p>
    <ul class="list-reset right clearfix sm-width-full py-2 mb-2 mb-lg-0">
      <li class="inline-block mr-1">
        <a href="https://twitter.com/share" class="twitter-share-button" data-hashtags="">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      </li>
      <li class="inline-block">
        <a class="github-button" href="https://github.com//" data-icon="octicon-star" data-count-href="//stargazers" data-count-api="/repos//#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star / on GitHub">Star</a>
      </li>
    </ul>
  </div>
</div>


  </body>

</html>

